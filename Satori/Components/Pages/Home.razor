@page "/"
@using Satori.AppServices.Models
@using Satori.AppServices.Services
@using Flurl
@inject IConnectionSettingsStore ConnectionSettingsStore
@inject UserService UserService

<PageTitle>Satori</PageTitle>

<h1>Welcome to Satori</h1>
<div style="display: flex;">

    <div>
        <p style="text-align: center;">
            <img src="images/Satori.png" alt="Satori" class="img-fluid" style="width: 100px; height: 214px;" />
        </p>
    </div>
    <div style="display: flex; justify-content: center; align-items: center; width: 600px; margin-left: 50px;">
        <p>
            Satori is web application that provides comprehension and understanding to the existing systems you already are using.
            These include issue tracking, project management, time tracking, and other systems.
            Unified dashboards pull information from multiple systems and merging them into a consistent view.
        </p>

    </div>
</div>

<h3>Integrations</h3>

<div class="card-stack">
    <div class="card">
        <div class="card-body">
            <a href="@_azureDevOpsUrl" target="_blank">
                <img src="images/AzureDevOps-Logo.png" alt="Azure DevOps Logo" />
                <p class="card-text">Azure DevOps</p>
            </a>
        </div>
        <div class="card-footer">
            <button class="btn btn-primary" @onclick="ShowAzureDevOps">Edit</button>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <a href="@_kimaiUrl" target="_blank">
                <img src="images/kimai_Logo.png" alt="Kimai Logo" />
                <p class="card-text">Kimai</p>
            </a>
        </div>
        <div class="card-footer">
            <button class="btn btn-primary">Edit</button>
        </div>
    </div>
    <div class="card">
        <div class="card-body">
            <a href="@_rabbitMqUrl" target="_blank">
                <img style="padding: 15px;" src="images/rabbitmq.svg" alt="RabbitMQ Logo" />
                <p class="card-text">RabbitMQ</p>
            </a>
        </div>
        <div class="card-footer">
            <button class="btn btn-primary">Edit</button>
        </div>
    </div>

</div>

<AzureDevOpsSettings @ref="_azureDevOpsSettings" />


<h5>Privacy Policy</h5>
<p>
    This web application does not store any data whatsoever on any server.
</p>
<p style="max-width: 800px;">
    The access keys to gain access to Azure DevOps, Kimai, or any other integrated service are stored locally in your web browser as encrypted data.
    Those keys are never captured to any other server.
    No data pulled from Azure Devops (work items & pull requests), Kimai (timesheets), or any other integrated service are shared or stored on any external service.
    This data is merely displayed in your web browser.
</p>

<h5>Contributions</h5>
<ul>
    <li><a target="_blank" href="https://github.com/TimothyK/Satori">Source Code</a></li>
    <li>by <a target="_blank" href="http://codemonkeyprojectiles.com">Timothy Klenke</a></li>
</ul>

@code
{
    private Uri? _azureDevOpsUrl;
    private Uri? _kimaiUrl;
    private Uri? _rabbitMqUrl;
    private AzureDevOpsSettings? _azureDevOpsSettings;

    protected override async Task OnInitializedAsync()
    {
        _azureDevOpsUrl = ConnectionSettingsStore.GetAzureDevOpsSettings().Url;
        var person = await UserService.GetCurrentUserAsync();
        _kimaiUrl = ConnectionSettingsStore.GetKimaiSettings().Url
            .AppendPathSegment(person.Language.Replace("-", "_"))
            .AppendPathSegment("timesheet")
            .ToUri();

        _rabbitMqUrl = new Uri($"http://{ConnectionSettingsStore.GetMessageQueueSettings().HostName}:15672");
    }

    private void ShowAzureDevOps()
    {
        _azureDevOpsSettings?.ShowAzureDevOps();
    }
}
